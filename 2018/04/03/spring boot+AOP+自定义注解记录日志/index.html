<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>spring boot+AOP+自定义注解记录日志 | 一只程序猿的博客</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="java 在 jdk1.5 中引入了注解，spring 框架也正好把 java 注解发挥得淋漓尽致。下面会讲解 Spring 中自定义注解的简单流程。 前提引入 maven 依赖:1234 &amp;lt;dependency&amp;gt;    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;    &amp;lt;artifactId&amp;gt;spring">
<meta property="og:type" content="article">
<meta property="og:title" content="spring boot+AOP+自定义注解记录日志">
<meta property="og:url" content="http://yoursite.com/2018/04/03/spring boot+AOP+自定义注解记录日志/index.html">
<meta property="og:site_name" content="一只程序猿的博客">
<meta property="og:description" content="java 在 jdk1.5 中引入了注解，spring 框架也正好把 java 注解发挥得淋漓尽致。下面会讲解 Spring 中自定义注解的简单流程。 前提引入 maven 依赖:1234 &amp;lt;dependency&amp;gt;    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;    &amp;lt;artifactId&amp;gt;spring">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-04-13T07:21:11.965Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="spring boot+AOP+自定义注解记录日志">
<meta name="twitter:description" content="java 在 jdk1.5 中引入了注解，spring 框架也正好把 java 注解发挥得淋漓尽致。下面会讲解 Spring 中自定义注解的简单流程。 前提引入 maven 依赖:1234 &amp;lt;dependency&amp;gt;    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;    &amp;lt;artifactId&amp;gt;spring">
  
    <link rel="alternative" href="/atom.xml" title="一只程序猿的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  
  

  <script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>
  <script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>

  
      <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
<script>AV.initialize("MW2iyQz6scY0XFrHP96SRKVb-gzGzoHsz", "9thbl1JAC6FeVjyjSEXHYBD1");</script>
<script src="/js/Counter.js"></script>
  
</head></html>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/yzcxy.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">一只程序猿</a></h1>
		</hgroup>

		
		<p class="header-subtitle">一切都是可以改变的，不可能只有庸人的词典里才有</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/hanfeng529264" title="github">github</a>
					        
								<a class="mail" target="_blank" href="/hf529264@163.com" title="mail">mail</a>
					        
								<a class="qq" target="_blank" href="/2286670111" title="qq">qq</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/hanfeng0310" title="weibo">weibo</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://keveon.me">keveon.me</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://pqsky.me">pqsky.me</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
	
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">一只程序猿</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/yzcxy.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">一只程序猿</h1>
			</hgroup>
			
			<p class="header-subtitle">一切都是可以改变的，不可能只有庸人的词典里才有</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/hanfeng529264" title="github">github</a>
			        
						<a class="mail" target="_blank" href="/hf529264@163.com" title="mail">mail</a>
			        
						<a class="qq" target="_blank" href="/2286670111" title="qq">qq</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/hanfeng0310" title="weibo">weibo</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-spring boot+AOP+自定义注解记录日志" class="article article-type-post" itemscope="" itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/04/03/spring boot+AOP+自定义注解记录日志/" class="article-date">
  	<time datetime="2018-04-02T16:00:00.000Z" itemprop="datePublished">2018-04-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      spring boot+AOP+自定义注解记录日志
      
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
        

        
          
<div class="counter-tag counter">
    <span id="/2018/04/03/spring boot+AOP+自定义注解记录日志/" class="leancloud_visitors post-title-link" style="font-size: 12px" data-flag-title="spring boot+AOP+自定义注解记录日志">
         &nbsp;
        view
    </span>
</div>

        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>java 在 jdk1.5 中引入了注解，spring 框架也正好把 java 注解发挥得淋漓尽致。<br>下面会讲解 Spring 中自定义注解的简单流程。</p>
<h2 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h2><p>引入 maven 依赖:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="一、自定义注解"><a href="#一、自定义注解" class="headerlink" title="一、自定义注解"></a>一、自定义注解</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义 操作记录 注解</span></span><br><span class="line"><span class="comment"> * 增加操作记录</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> hanfeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target</span>(&#123;ElementType.PARAMETER, ElementType.METHOD&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ActionRecord &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自定义参数</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    String parma;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自定义参数 可以设置默认值</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    String parma <span class="keyword">default</span> <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如上，一个自定义注解就已经定义结束，当然你也可以加上一些约束，比如只能加在类上，方法上等，这里不做举例。</p>
<h2 id="二、解析注解"><a href="#二、解析注解" class="headerlink" title="二、解析注解"></a>二、解析注解</h2><p>此处使用了spring 的 AOP（面向切面编程）特性,通过 <code>@Aspect</code> 注解使该类成为切面类,通过 <code>@Pointcut</code> 指定切入点 ，这里指定的切入点为 ActionRecord 注解类型，也就是被 <code>@ActionRecord</code> 注解修饰的方法，进入该切入点。</p>
<p>注解简述：</p>
<ul>
<li>@Before 前置通知：在某连接点之前执行的通知，但这个通知不能阻止连接点之前的执行流程（除非它抛出一个异常）。</li>
<li>@Around 环绕通知：可以实现方法执行前后操作，需要在方法内执行point.proceed(); 并返回结果。</li>
<li>@AfterReturning 后置通知：在某连接点正常完成后执行的通知：例如，一个方法没有抛出任何异常，正常返回。</li>
<li>@AfterThrowing 异常通知：在方法抛出异常退出时执行的通知。</li>
<li>@After 后置通知：在某连接点正常完成后执行的通知：例如，一个方法没有抛出任何异常，正常返回。</li>
<li><p>切入点参数说明：<br>  controllerAspect: 指定要扫描的包。<br>  @Pointcut中符号的解释：</p>
<pre><code>第一个 * 代表任意修饰符及任意返回值. 
第二个 * 任意包名 
第三个 * 代表任意方法. 
第四个 * 定义在web包或者子包 
第五个 * 任意方法 
.. 匹配任意数量的参数.
</code></pre></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.thunisoft.dzjz.commons.utils.UUIDUtils;</span><br><span class="line"><span class="keyword">import</span> com.thunisoft.dzjz.model.CzrzEntity;</span><br><span class="line"><span class="keyword">import</span> com.thunisoft.dzjz.service.CzrzService;</span><br><span class="line"><span class="keyword">import</span> javassist.*;</span><br><span class="line"><span class="keyword">import</span> javassist.bytecode.CodeAttribute;</span><br><span class="line"><span class="keyword">import</span> javassist.bytecode.LocalVariableAttribute;</span><br><span class="line"><span class="keyword">import</span> javassist.bytecode.MethodInfo;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.log4j.Log4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.Signature;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.reflect.MethodSignature;</span><br><span class="line"><span class="keyword">import</span> org.json.JSONArray;</span><br><span class="line"><span class="keyword">import</span> org.json.JSONObject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.ObjectUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 操作记录aop</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> hanfeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 4.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Log</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CzrzAopAction</span> </span>&#123;</span><br><span class="line">    <span class="comment">//保证并发下 数据的纯洁</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;MetaData&gt; metaDataContainer = ThreadLocal.withInitial(MetaData::<span class="keyword">new</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取开始时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> BEGIN_TIME;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取结束时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> END_TIME;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取监控的方法名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String METHOD_NAME;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定义本次log实体</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;CzrzEntity&gt; czrzEntities = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 切入点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(* com.thunisoft.dzjz.server.controller..*.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">controllerAspect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 前置通知</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"controllerAspect()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doBefore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        BEGIN_TIME = System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 后置通知</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"controllerAspect()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        END_TIME = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(METHOD_NAME)) &#123;</span><br><span class="line">            log.debug(<span class="string">"方法：【"</span> + METHOD_NAME + <span class="string">"】运行时间为："</span> + (END_TIME - BEGIN_TIME));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 方法结束执行后的操作</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> object response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterReturning</span>(returning = <span class="string">"object"</span>, pointcut = <span class="string">"controllerAspect()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfter</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//因为我的接口都是 RESTful 风格的  所以我才这么梳理  最终的验证视业务而定</span></span><br><span class="line">            ResponseEntity responseEntity = (ResponseEntity) object;</span><br><span class="line">            <span class="keyword">if</span> (responseEntity.getStatusCode().is2xxSuccessful()) &#123;</span><br><span class="line">                <span class="comment">//保存记录  数据入库  不想用异步线程的  直接插入  保存方式视情况选择吧</span></span><br><span class="line">                CzrzRunner czrzRunner = <span class="keyword">new</span> CzrzRunner(czrzEntities, czrzService);</span><br><span class="line">                czrzRunner.run();</span><br><span class="line">                <span class="keyword">for</span> (CzrzEntity czrzEntity : czrzEntities) &#123;</span><br><span class="line">                    czrzService.addCzrz(czrzEntity);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.info(<span class="string">"当前方法执行结束后拦截不到操作状态"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 方法有异常时的操作</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterThrowing</span>(<span class="string">"controllerAspect()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterThrow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.error(<span class="string">"增加操作记录异常"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 环绕通知</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pjp 切片连接点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回结果</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable 异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around</span>(<span class="string">"controllerAspect()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(JoinPoint pjp)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="comment">//自定义的当前线程的全局信息  可有可无 视业务增加</span></span><br><span class="line">        MetaData metaData = CzrzAopAction.metaDataContainer.get();</span><br><span class="line">        <span class="comment">//获取被拦截的方法</span></span><br><span class="line">        Method method = getActionRecordMethod(metaData, pjp);</span><br><span class="line">        <span class="keyword">if</span> (method == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//log.info(……)；</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取注解信息</span></span><br><span class="line">        ActionRecord actionRecord = method.getAnnotation(ActionRecord.class);</span><br><span class="line">        <span class="keyword">if</span> (actionRecord == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//log.info(……)；</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 默认不需要记录操作日志，如果有 ActionRecord 注解，说明需要记录日志</span></span><br><span class="line">        metaData.setNeedRecord(<span class="keyword">true</span>);</span><br><span class="line">        HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();</span><br><span class="line">        metaData.fillReqInfo(request);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取请求中的参数 这里面包含了controller不需要的参数，需单独处理</span></span><br><span class="line">        String queryString = request.getQueryString();</span><br><span class="line">        <span class="comment">//获取controller参数</span></span><br><span class="line">        Map&lt;String, String[]&gt; queryMap = dealQueryData(pjp, queryString);</span><br><span class="line">        <span class="comment">//获取参数键值对</span></span><br><span class="line">        Map&lt;String, String[]&gt; queryRequestMap = request.getParameterMap();</span><br><span class="line">        <span class="comment">//做去重处理  兼容各种参数形式</span></span><br><span class="line">        queryMap.putAll(queryRequestMap);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *说明 ：上面为什么样这么获取参数，是因为单存的用一种不能拦截到所有情况的参数。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">/**开始组装 日志实体信息   dosomeThing  这里不举例了</span></span><br><span class="line"><span class="comment">         * 操作记录模板需要定制化的 要自己来实现模板数据的解析</span></span><br><span class="line"><span class="comment">         * 如果 不同的功能记录不同的信息模板  则可以用下面的方式  否则只需要一条就ok</span></span><br><span class="line"><span class="comment">         * 条件视业务定  如果定义了  metaData 需要将结果放入其中  如果没有  直接做入库操作即可</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">switch</span> (actionRecord.operation()) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">               dosomeThingToBuildczrzEntities；</span><br><span class="line">                metaData.czrzEntities.add(czrzEntity);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                dosomeThingToBuildczrzEntities；</span><br><span class="line">                metaData.czrzEntities.add(czrzEntity);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">               dosomeThingToBuildczrzEntities；</span><br><span class="line">               metaData.czrzEntities.add(czrzEntity);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The type Meta data.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MetaData</span> </span>&#123;……&#125;</span><br></pre></td></tr></table></figure>
<p>上面方法：<code>getActionRecordMethod</code> 的实现<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 获取监控的方法</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> metaData</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> pjp 切片点</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> 方法</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> Method <span class="title">getActionRecordMethod</span><span class="params">(MetaData metaData, JoinPoint pjp)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// 拦截的方法名称。当前正在执行的方法</span></span><br><span class="line">       Signature sig = pjp.getSignature();</span><br><span class="line">       metaData.setMethodName(sig.getName());</span><br><span class="line">       <span class="comment">// 拦截的放参数类型</span></span><br><span class="line">       <span class="keyword">if</span> (!(sig <span class="keyword">instanceof</span> MethodSignature)) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> BadRequestException(<span class="string">"添加操作记录失败。原因：@ActionRecord 该注解只能用于方法"</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       MethodSignature msig = (MethodSignature) sig;</span><br><span class="line">       Class[] parameterTypes = msig.getMethod().getParameterTypes();</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="keyword">return</span> pjp.getTarget().getClass().getMethod(sig.getName(), parameterTypes);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">           log.warn(<span class="string">"添加操作记录失败。原因：增加操作记录，监控方法时出现异常，方法名称：&#123;&#125;"</span>, sig.getName(), e);</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>上面方法： <code>dealQueryData</code> 的实现<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理拦截导弹参数和参数名称</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pjp         切片连接点</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> queryString requset请求中参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 参数键值对</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception 异常</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> Map&lt;String, String[]&gt; dealQueryData(JoinPoint pjp, String queryString) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">//获取请求方法中的参数名称</span></span><br><span class="line">    String[] paramName = getFieldsName(pjp.getTarget().getClass().getName(), metaDataContainer.get().getMethodName());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 拦截的controller方法参数值</span></span><br><span class="line">    Object[] args = pjp.getArgs();</span><br><span class="line">    <span class="keyword">if</span> (ObjectUtils.isEmpty(paramName) || args.length != paramName.length) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    String paramterConnector = <span class="string">"&amp;"</span>;</span><br><span class="line">    String paramterAssignment = <span class="string">"="</span>;</span><br><span class="line">    Map&lt;String, String[]&gt; resultMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isNotBlank(queryString)) &#123;</span><br><span class="line">        <span class="comment">//这里获取到的结构是 key=value 的格式</span></span><br><span class="line">        String[] queryKeyAndValue = queryString.split(paramterConnector);</span><br><span class="line">        <span class="keyword">for</span> (String parameter : queryKeyAndValue) &#123;</span><br><span class="line">            <span class="comment">//这里获取到的结构是 key &amp; value 的值</span></span><br><span class="line">            String[] queryValue = parameter.split(paramterAssignment);</span><br><span class="line">            <span class="keyword">if</span> (resultMap.containsKey(queryValue[<span class="number">0</span>])) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            resultMap.put(queryValue[<span class="number">0</span>], <span class="keyword">new</span> String[] &#123; queryValue[<span class="number">1</span>] &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; paramName.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (resultMap.containsKey(paramName[i])) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//做下特殊处理，有的解析后是个数组兼容下  可以视自己的业务来处理解析结果</span></span><br><span class="line">        <span class="keyword">if</span> (args[i] <span class="keyword">instanceof</span> String[]) &#123;</span><br><span class="line">            resultMap.put(paramName[i], (String[]) args[i]);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (args[i] <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">            resultMap.put(paramName[i], <span class="keyword">new</span> String[] &#123; args[i].toString() &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(ObjectUtils.isEmpty(args[i]))&#123;</span><br><span class="line">            resultMap.put(paramName[i],<span class="keyword">new</span> String[]&#123;&#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Object obj = args[i];</span><br><span class="line">            BeanInfo beanInfo = Introspector.getBeanInfo(obj.getClass());</span><br><span class="line">            PropertyDescriptor[] propertyDescriptors = beanInfo.getPropertyDescriptors();</span><br><span class="line">            <span class="keyword">for</span> (PropertyDescriptor property : propertyDescriptors) &#123;</span><br><span class="line">                String key = property.getName();</span><br><span class="line">                <span class="keyword">if</span> (key.compareToIgnoreCase(<span class="string">"class"</span>) == <span class="number">0</span> || key.compareToIgnoreCase(<span class="string">"writer"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                Method getter = property.getReadMethod();</span><br><span class="line">                Object value = getter != <span class="keyword">null</span> ? getter.invoke(obj) : <span class="keyword">null</span>;</span><br><span class="line">                String objV = ObjectUtils.isEmpty(value) ? <span class="string">""</span> : value.toString();</span><br><span class="line">                resultMap.put(key, <span class="keyword">new</span> String[] &#123; objV &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> resultMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>方法：<code>getFieldsName</code> 的实现<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 使用javassist来获取方法参数名称</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> className  类名</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> methodName 方法名</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> 名字集合</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> Exception 异常</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> String[] getFieldsName(String className, String methodName) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       Class&lt;?&gt; clazz = Class.forName(className);</span><br><span class="line">       String clazzName = clazz.getName();</span><br><span class="line">       ClassPool pool = ClassPool.getDefault();</span><br><span class="line">       ClassClassPath classPath = <span class="keyword">new</span> ClassClassPath(clazz);</span><br><span class="line">       pool.insertClassPath(classPath);</span><br><span class="line"></span><br><span class="line">       CtClass ctClass = pool.get(clazzName);</span><br><span class="line">       CtMethod ctMethod = ctClass.getDeclaredMethod(methodName);</span><br><span class="line">       MethodInfo methodInfo = ctMethod.getMethodInfo();</span><br><span class="line">       CodeAttribute codeAttribute = methodInfo.getCodeAttribute();</span><br><span class="line">       LocalVariableAttribute attr = (LocalVariableAttribute) codeAttribute.getAttribute(LocalVariableAttribute.tag);</span><br><span class="line">       <span class="keyword">if</span> (attr == <span class="keyword">null</span>) &#123;</span><br><span class="line">           String message = <span class="string">"添加操作记录失败。原因：拦截请求：【"</span> + metaDataContainer.get().getMethodName() + <span class="string">" 】的方法中的参数名称失败"</span>;</span><br><span class="line">           log.warn(message);</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> BadRequestException(message);</span><br><span class="line">       &#125;</span><br><span class="line">       String[] paramsArgsName = <span class="keyword">new</span> String[ctMethod.getParameterTypes().length];</span><br><span class="line">       <span class="keyword">int</span> pos = Modifier.isStatic(ctMethod.getModifiers()) ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; paramsArgsName.length; i++) &#123;</span><br><span class="line">           paramsArgsName[i] = attr.variableName(i + pos);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (ObjectUtils.isEmpty(paramsArgsName)) &#123;</span><br><span class="line">           String message = <span class="string">"添加操作记录失败。原因：拦截请求：【"</span> + metaDataContainer.get().getMethodName() + <span class="string">" 】的方法中的参数名称失败"</span>;</span><br><span class="line">           log.warn(message);</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> BadRequestException(message);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> paramsArgsName;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>小编认为，如果没有特殊 <code>@Before</code>、<code>@Around</code>、<code>@AfterReturning</code>、<code>@AfterThrowing</code>、<code>@After</code> 这些功能只需要保留 <code>@Before</code>、<code>@AfterReturning</code>、<code>@AfterThrowing</code> 这三个就可以慢足需求，<br>在<code>@Before</code> 中组装信息，<br>在 <code>@AfterReturning</code> 来确认数据是否需要保留，<br>在 <code>@AfterThrowing</code> 来处理异常情况。<br> 使用 AOP 还是很方便的。</p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/04/14/Spring AOP的实现原理/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">&lt;</strong>
      <div class="article-nav-title">
        
          Spring AOP的实现原理
        
      </div>
    </a>
  
  
    <a href="/2018/03/17/使用Thymeleaf API渲染模板生成静态页面/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Thymeleaf API渲染模板</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>


<div class="ds-share share" data-thread-key="spring boot+AOP+自定义注解记录日志" data-title="spring boot+AOP+自定义注解记录日志" data-url="http://yoursite.com/2018/04/03/spring boot+AOP+自定义注解记录日志/" data-images="/img/yzcxy.jpg" data-content="spring boot+AOP+自定义注解记录日志">
    <div class="ds-share-inline">
      <ul class="ds-share-icons-16">
      	<li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
        <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
        <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
        <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
        <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>
      </ul>
      <div class="ds-share-icons-more">
      </div>
    </div>
 </div>
 

 







</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2019 一只程序猿
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>

    </div>
	
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="/js/main.js"></script>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js"></script>


  </div>
 
</body>
</html>